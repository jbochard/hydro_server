#!/usr/bin/ruby
# coding: utf-8

require 'fileutils'
require 'json'
require 'mongo'

command = (ARGV.empty?) ? "":ARGV.shift 
base_dir = Gem.bin_path('rubiponia', 'rubyponia').gsub("/bin/rubyponia", "")

if command.casecmp("install") == 0
	FileUtils.mkdir("./config")
	FileUtils.copy_file("#{base_dir}/lib/templates/environment.json", 	"./config/environment.json")
	puts "Programa instalado."
	exit
end

config = JSON.parse(File.read("config/environment.json"))

if command.casecmp("start") == 0
	exec("thin start --port #{config['port']} -C #{base_dir}/lib/thin.yml --rackup #{base_dir}/lib/config.ru")
end

if command.casecmp("stop") == 0
	exec("thin stop --port #{config['port']} -C #{base_dir}/lib/thin.yml --rackup #{base_dir}/lib/config.ru")
end

